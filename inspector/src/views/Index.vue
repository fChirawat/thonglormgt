<template>
<<<<<<< HEAD
  <div class="min-h-screen bg-white flex flex-col items-center p-6 relative">
    
    <div class="fixed top-6 right-6">
      <button
        class="w-14 h-14 flex items-center justify-center rounded-full shadow-lg bg-red-500 hover:bg-red-600 text-white relative"
      >
        <span class="text-2xl">üîî</span>
        <span
          v-if="badgeCount > 0"
          class="absolute -top-1 -right-1 bg-white text-red-600 text-xs font-bold w-5 h-5 rounded-full flex items-center justify-center border"
        >
          {{ badgeCount }}
        </span>
      </button>
    </div>
=======
  <div class="min-h-screen bg-white flex flex-col items-center p-6">
    <!-- ‡∏õ‡∏∏‡πà‡∏° Logout -->
    <button @click="logout" class="flex flex-col items-center text-sm text-gray-700 mb-4">
      <span class="text-2xl">‚öôÔ∏è</span>
      <span>‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</span>
    </button>
>>>>>>> 2c0ec257df8b67e1f17359536c85b58edb9deca5

    <h1 class="text-lg font-bold mb-6">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£</h1>

    <!-- ‡πÄ‡∏°‡∏ô‡∏π -->
    <div class="w-full max-w-md space-y-3">
      <button
        v-for="item in menuItems"
        :key="item.label"
        :class="[
          'w-full flex items-center justify-between px-4 py-3 border rounded-xl shadow-sm',
          item.checked ? 'bg-green-400 text-white cursor-not-allowed' : 'hover:bg-gray-50'
        ]"
        @click="goToPage(item)"
      >
        <span class="flex items-center space-x-2">
          <span class="text-xl font-bold">+</span>
          <span>{{ item.label }}</span>
        </span>
      </button>
    </div>
  </div>
</template>

<script setup>
<<<<<<< HEAD
import { ref } from "vue";

const menuItems = [
  { label: "‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô" },
  { label: "‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô" },
  { label: "‡∏£‡∏≤‡∏¢‡∏õ‡∏µ" },
  { label: "‡πÑ‡∏ï‡∏£‡∏°‡∏≤‡∏™" },
];

const badgeCount = ref(1); 
=======
import { onMounted, ref } from "vue";
import { useRouter } from "vue-router";
import axios from "axios";

const router = useRouter();

// ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏ô‡∏π
const menuItems = ref([
  { label: "‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°", checked: false },
  { label: "‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á", checked: false },
]);

// Mapping ‡∏õ‡πâ‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏õ‡∏¢‡∏±‡∏á route
const routeMap = {
  "‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°": "/InspectionDay",
  "‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á": "/history",
};

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏â‡∏û‡∏≤‡∏∞
const goToPage = (item) => {
  if (item.checked) {
    alert("‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß");
    return; // ‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏∑‡πà‡∏ô
  }

  const path = routeMap[item.label];
  if (path) router.push(path);
};

// ‡∏î‡∏∂‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏à‡∏≤‡∏Å API
const fetchStatus = async () => {
  try {
    // ‡πÉ‡∏ä‡πâ Promise.all ‡∏î‡∏∂‡∏á‡∏ó‡∏∏‡∏Å category
    const categories = ["‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£ (day)", "‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£ (month)", "‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£ (quarter)", "‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£ (year)"];
    const requests = categories.map(cat =>
      axios.get("http://localhost:8001/api/method/thonglormgt.thonglormgt.doctype.formmm.formmm.get_inspection_status", { params: { category: cat } })
    );

    const responses = await Promise.all(requests);

    // Mapping category => menuItems index
    const catMap = {
      "‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£ (day)": 0,
      "‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£ (month)": 1,
      "‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£ (year)": 2,
      "‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£ (quarter)": 3,
    };

    responses.forEach(res => {
      const data = res.data.message;
      const cat = data.length > 0 && data[0].status !== undefined ? Object.keys(catMap).find(k => catMap[k] === catMap[k]) : null;

      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ checked ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
      const isChecked = data.some(d => d.status === "checked");
      // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó menuItems
      const idx = catMap[res.config.params.category];
      if (idx !== undefined) menuItems.value[idx].checked = isChecked;
    });

  } catch (error) {
    console.error(error);
  }
};

// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ session ‡∏Ç‡∏≠‡∏á Frappe ‡∏¢‡∏±‡∏á‡∏≠‡∏¢‡∏π‡πà
const checkLogin = async () => {
  try {
    const res = await fetch("/api/method/frappe.auth.get_logged_user", { credentials: "include" });
    const data = await res.json();
    if (!data.message || data.message === "Guest") router.replace("/login");
  } catch (error) {
    console.error(error);
    router.replace("/login");
  }
};

// Logout ‚Üí ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ login
const logout = async () => {
  try { await fetch("/api/method/logout", { credentials: "include" }); } 
  catch (error) { console.error(error); } 
  finally { router.replace("/login"); }
};

onMounted(() => {
  checkLogin();
  fetchStatus();
});
>>>>>>> 2c0ec257df8b67e1f17359536c85b58edb9deca5
</script>
